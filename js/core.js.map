{"version":3,"sources":["core.js"],"names":["window","components","forms","doc","win","updateZIPPlaceholder","ZIPLabel","getElementById","countrySelect","value","setAttribute","toggleCountryField","countryInput","remove","classList","add","countryLabel","handleSigningError","e","errorMessageContainer","$c","errorMessage","errorMessageInfo","commitmentForm","removeAttribute","submitted","textContent","type","status","statusText","appendChild","alert","submitButton","handleSigningSuccess","submitForm","event","compilePayload","petitionFormData","identifier","website","location","origin","tags","JSON","parse","querySelector","noOptIn","name","email","ZIP","country","stringify","loadSignatureResponse","commitmentStatus","preventDefault","XMLHttpRequest","open","dataset","host","setRequestHeader","addEventListener","send","addEventListeners","init","body","getElementsByTagName","innerHTML","views","modals","PlainModalView","innerHtml","modal","close","ShareDaisyModalView","shareContainer","shareLink","shareUrl","encodeURIComponent","tweet","buttons","facebookAnchor","gPlusAnchor","tweetAnchor","this","document","createElement","bind","triggerComponents","i","undefined","split","length","listenerFn","top","pageYOffset","scrollTop","clientTop","removeEventListener","gl","querySelectorAll","url","protocol"],"mappings":"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","file":"core.js","sourcesContent":["/*\n @licstart  The following is the entire license notice for the\n    JavaScript code in this page.\n\n Copyright (C) 2015 Fight for the Future\n\n The JavaScript code in this page is free software: you can\n redistribute it and/or modify it under the terms of the GNU\n General Public License (GNU GPL) as published by the Free Software\n Foundation, either version 3 of the License, or (at your option)\n any later version. The code is distributed WITHOUT ANY WARRANTY;\n without even the implied warranty of MERCHANTABILITY or FITNESS\n FOR A PARTICULAR PURPOSE. See the GNU GPL for more details.\n\n As additional permission under GNU GPL version 3 section 7, you\n may distribute non-source (e.g., minimized or compacted) forms of\n that code without the copy of the GNU GPL normally required by\n section 4, provided you include this license notice and a URL\n through which recipients can access the Corresponding Source.\n\n @licend  The above is the entire license notice\n    for the JavaScript code in this page.\n*/\nwindow.components = window.components || {};\nwindow.components.forms = function (doc, win) {\n  /**\n   * Retrieves form data from Action Network API, then submits entry\n   * @param {object} doc - Document object\n   * @param {object} win - Window object\n   * */\n  \"use strict\";\n\n  var\n    body = doc.getElementsByTagName('body')[0],\n    submitButton = body.querySelector('[type=\"submit\"]'),\n    submitted = $c('div'),\n    countryLabel = doc.querySelector('[for=\"select-country\"]'),\n    countrySelect = doc.getElementById('select-country'),\n    countryInput = doc.getElementById('hidden-country'),\n    commitmentForm = doc.forms[0];\n\n  submitted.classList.add('submitted');\n  submitted.innerHTML = '<h2>Hang on a tick&hellip;</h2><h3>&hellip;reticulating splines.</h3><div class=\"circle-spinner\">&nbsp;</div> '\n\n  function updateZIPPlaceholder() {\n    /**\n     * Updates placeholder on ZIP/Post Code field to be appropriate for country\n     * selected\n     * */\n    var\n      ZIPLabel = doc.getElementById('form-zip_code');\n\n    if (countrySelect.value !== 'US') {\n      ZIPLabel.setAttribute('placeholder', 'Post code');\n    } else {\n      ZIPLabel.setAttribute('placeholder', 'ZIP');\n    }\n  }\n\n  function toggleCountryField() {\n    /**\n     * Hides the label and shows the select when someone changes their signature\n     * country.\n     * */\n\n    countryInput.remove();\n    countrySelect.setAttribute('name', 'answer[country]');\n    countrySelect.classList.add('visible');\n    countryLabel.classList.add('hidden');\n  }\n\n  function handleSigningError(e) {\n    /**\n     * Figures out what to say at just the right moment\n     * @param {event|XMLHttpRequest} e - Might be an event, might be a response\n     * from an XMLHttpRequest\n     * */\n\n    var\n      errorMessageContainer = $c('div'),\n      errorMessage = $c('h2'),\n      errorMessageInfo = $c('p');\n\n    commitmentForm.removeAttribute('disabled');\n    submitted.remove();\n    errorMessage.textContent = 'Something went wrong';\n    if (e.type) {\n      errorMessageInfo.textContent = 'There seems to be a problem somewhere in between your computer and our server. Might not be a bad idea to give it another try.';\n    } else if (e.status) {\n      errorMessageInfo.textContent = '(the nerdy info is that the server returned a status of \"' + e.status + '\" and said \"' + e.statusText + '\".)'\n    } else {\n      errorMessageInfo.textContent = 'this seems to be a weird error. the nerds have been alerted.';\n    }\n\n    errorMessageContainer.appendChild(errorMessage);\n    errorMessageContainer.appendChild(errorMessageInfo);\n    /*\n    new win.controllers.modals.PlainModalController({\n      modal_content: errorMessageContainer\n    });\n    */\n    alert(errorMessageInfo.textContent); // JL HACK ~ lol\n\n    submitted.remove();\n    submitButton.removeAttribute('disabled');\n  }\n\n  function handleSigningSuccess() {\n    /**\n     * Figures out what to say at just the right moment\n     * @param {event|XMLHttpRequest} e - Might be an event, might be a response\n     * from an XMLHttpRequest\n     * */\n\n    var\n      modalContent = $c('div');\n\n    /*\n    modalContent.innerHTML = '<h2>Thanks for signing</h2>\\n<p>Now, share this page to spread the word.</p>\\n<p><small>…or, <a href=\"https://donate.fightforthefuture.org/?amount=5&frequency=just-once\">chip in $5</a> to help us spread the message.</small></p>';\n    modalContent.appendChild(doc.getElementById('share-modal'));\n\n    new win.controllers.modals.PlainModalController({\n      modal_content: modalContent\n    });\n    */\n  }\n\n  function submitForm(event) {\n    /**\n     * Submits the form to ActionNetwork. If the script doesn’t, by now, know\n     * the action_network identifier, default isn’t prevented on the event and\n     * form submission proceeds as normal.\n     * @param {event} event - Form submission event\n     * */\n\n    event.preventDefault();\n\n    var\n      commitmentStatus = new XMLHttpRequest();\n\n    commitmentForm.setAttribute('disabled', true);\n    submitted.classList.add('submitted');\n    submitButton.setAttribute('disabled', true);\n    commitmentForm.appendChild(submitted);\n\n    function compilePayload() {\n      /**\n       * Compiles the form data into a JSON payload for Ajax submission\n       * @return {object} petitionFormData - just the info the API needs\n       * */\n\n      var\n        petitionFormData = {\n          identifier: '86ef7be3-da62-480c-ab42-4643c0f93be8',\n          website: win.location.origin,\n          tags: JSON.parse(doc.querySelector('[name=\"subscription[tag_list]\"]').value),\n          noOptIn: false,\n          name: doc.getElementById('form-first_name').value,\n          email: doc.getElementById('form-email').value,\n          ZIP: doc.getElementById('form-zip_code').value,\n          country: countrySelect.value\n        };\n\n      return JSON.stringify(petitionFormData);\n    }\n\n    function loadSignatureResponse() {\n      /**\n       * Does the thing after we get a response from the API server\n       * */\n\n      if (commitmentStatus.status >= 200 && commitmentStatus.status < 400) {\n        handleSigningSuccess()\n      } else {\n        handleSigningError(commitmentStatus);\n      }\n    }\n\n    commitmentStatus.open('POST', commitmentForm.dataset.host + '/submission', true);\n    commitmentStatus.setRequestHeader('Content-Type', 'application/json');\n    commitmentStatus.addEventListener('error', handleSigningError);\n    commitmentStatus.addEventListener('load', loadSignatureResponse);\n    commitmentStatus.send(compilePayload());\n  }\n\n  function addEventListeners() {\n    /**\n     * Attaches all the listeners all the places\n     * */\n    countryLabel.addEventListener('click', toggleCountryField);\n    countrySelect.addEventListener('change', updateZIPPlaceholder);\n    commitmentForm.addEventListener('submit', submitForm);\n  }\n\n  function init() {\n    addEventListeners();\n  }\n\n  init();\n};\n\n;(function (doc, win) {\n  win.views = win.views || {};\n  win.views.modals = {\n    PlainModalView: function (innerHtml) {\n      /**\n       * Generates the markup for a good ol modal\n       * @param {node} innerHtml - Html to render\n       * */\n      var\n        modal = $c('div'),\n        close = $c('button');\n\n      close.classList.add('close');\n      close.textContent = '\\327';\n\n      modal.classList.add('modal', '_plain_modal');\n      modal.appendChild(close);\n      modal.appendChild(innerHtml);\n\n      return modal;\n    },\n    ShareDaisyModalView: function (innerHtml) {\n      /**\n       * Generates the markup for a good ol modal. Requires an element on-page\n       * with id 'share-modal' which contains a data-share-url of `cgi_escape`d\n       * page URL as well as a data-tweet with `cgi_escape`d tweet.\n       * @param {node} innerHtml - Html to render _above_ share buttons.\n       * */\n      var\n        shareContainer = doc.getElementById('share-modal'),\n      // TODO the utm_campaign value throws an error on a non-campaign page probably\n        shareLink = shareContainer.dataset.shareUrl + '&utm_source=petitions&utm_medium=web&utm_campaign=' + encodeURIComponent(doc.getElementById('petition-title').textContent),\n        tweet = shareContainer.dataset.tweet,\n        buttons = $c('div'),\n        facebookAnchor = $c('a'),\n        gPlusAnchor = $c('a'),\n        tweetAnchor = $c('a');\n\n      buttons.classList.add('modal-share-links');\n\n      facebookAnchor.setAttribute('href', 'https://facebook.com/sharer.php?u=' + shareLink);\n      facebookAnchor.classList.add('modal-share-link', 'share-this-fb');\n      facebookAnchor.textContent = 'Share on Facebook';\n\n      gPlusAnchor.setAttribute('href', 'https://plus.google.com/share?url=' + shareLink);\n      gPlusAnchor.classList.add('modal-share-link', 'share-this-gp');\n      gPlusAnchor.textContent = 'Share on Google Plus';\n\n      tweetAnchor.setAttribute('href', 'https://twitter.com/share?text=' + tweet + '&url=' + shareLink);\n      tweetAnchor.classList.add('modal-share-link', 'share-this-tw');\n      tweetAnchor.textContent = 'Tweet this page';\n\n      buttons.appendChild(facebookAnchor);\n      buttons.appendChild(gPlusAnchor);\n      buttons.appendChild(tweetAnchor);\n\n      shareContainer.innerHTML = innerHtml;\n      shareContainer.appendChild(buttons);\n\n      return this.PlainModalView(shareContainer);\n    }\n  };\n\n}(document, window));\n\n;var $c  = document.createElement.bind(document);\n\n(function (doc, win) {\n  \"use strict\";\n\n  function triggerComponents() {\n    win.components = win.components || {};\n    var\n      i = 0,\n      components = doc.getElementsByTagName('body')[0].dataset.components;\n\n    if (components !== undefined) {\n      components = components.split(' ');\n      i = components.length;\n\n      while (i--) {\n        if (components[i] !== '' && win.components[components[i]] !== undefined) {\n          win.components[components[i]](doc, win);\n        }\n      }\n    }\n  }\n\n  triggerComponents();\n\n  var listenerFn = function() {\n    var top = (window.pageYOffset || doc.scrollTop)  - (doc.clientTop || 0);\n    if (top > 300) {\n      window.removeEventListener('scroll', listenerFn);\n      document.querySelector('ul.share').classList.add('visible');\n    }\n  }\n\n  window.addEventListener('scroll', listenerFn);\n\n  var gl = document.querySelectorAll('button.google');\n    for (var i = 0; i < gl.length; i++) {\n        gl[i].addEventListener('click', function(e) {\n            e.preventDefault();\n            var url = window.location.protocol + '//' + window.location.host;\n            window.open('https://plus.google.com/share?url='+url, 'share_gl', 'width=500, height=300, toolbar=no, status=no, menubar=no');\n        }, false);\n    }\n\n\n})(document, window);\n\n//# sourceMappingURL=core.js.map"]}